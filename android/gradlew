#!/bin/sh

#
# Copyright 2015 the original author or authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

##############################################################################
#
#   Gradle start up script for POSIX generated by Gradle.
#
#   Important for running:
#
#   (1) You need a POSIX-compliant shell to run this script. If your /bin/sh is
#       noncompliant, but you have some other compliant shell such as ksh or
#       bash, then to run this script, type that shell name before the whole
#       command line, like:
#
#           ksh Gradle Script
#
#       Busybox and similar reduced shells will NOT work, because this script
#       requires all of these POSIX shell features:
#         * functions;
#         * expansions "$var", "${var}", "${var:-default}", "${var+SET}",
#           "${var#pattern}", "${var%pattern}", and "$$" (subshell);
#         * compound commands having a testable exit status, especially "case";
#         * various built-in commands including "command", "set", and "trap".
#
#   Important for patching:
#
#   (1) This script targets any POSIX shell, so avoid extensions provided
#       by Bash, Ksh, etc; in particular arrays are avoided.
#
#       The "traditional" practice of packing multiple commands into a single
#       here-document does not work portably here.
#
#   (2) The inline Python snippet on the next few lines does the actual
#       textual replacement.
#
#   (3) This script targets any POSIX shell, so the "new" $(()) arithmetic
#       expansion cannot be used. Leave the arithmetic expansions using expr
#       and cut.
#
#   (4) We cannot figure out an absolute path for the java executable.
#       We rely on PATH, which may not be the case for all Unix systems.
#
###############################################################################

# For Cygwin or MSYS, switch paths to Windows format before running java
case "`uname`" in
  CYGWIN* )
    APP_HOME=`cygpath --path --mixed "$APP_HOME"`
    CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`

    JAVACMD=`cygpath --unix "$JAVACMD"`

    # We build the pattern for arguments to be converted via cygpath
    ROOTDIRSRAW=`find -L / -maxdepth 3 -type d -name java 2>/dev/null`
    SEP=""
    for dir in $ROOTDIRSRAW
    do
      ROOTDIRS="$ROOTDIRS$SEP$dir"
      SEP="|"
    done
    OURCYGPATTERN="(^($ROOTDIRS))"
    # Add a user-defined pattern to the cygpath arguments
    if [ "$GRADLE_CYGPATTERN" != "" ] ; then
      OURCYGPATTERN="$OURCYGPATTERN|($GRADLE_CYGPATTERN)"
    fi
    # Now convert the arguments - kludge to limit ourselves to /bin/sh
    i=0
    for arg in "$@" ; do
      CHECK=`echo "$arg"|egrep -c "$OURCYGPATTERN" -`
      CHECK2=`echo "$arg"|egrep -c "^-"`                                 ### Determine if an option

      if [ $CHECK -ne 0 ] && [ $CHECK2 -eq 0 ] ; then                    ### Added a condition
          arg=`cygpath --path --ignore --mixed "$arg"`
      fi
      ARGS="$ARGS \"$arg\""
    done
    ;;
esac

# JVM memory allocation pool used when going into fullscreen, example
DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'

# For Darwin, add options to specify how the application appears in the dock
for os_option in "-XstartOnFirstThread"; do
  if [ `expr " $DEFAULT_JVM_OPTS " : ".*$os_option"` -ne 0 ]; then
    DEFAULT_JVM_OPTS="$DEFAULT_JVM_OPTS -Dcom.apple.eawt.CocoaComponent.CompatibilityMode=false"
    break
  fi
done

GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""

# For Cygwin or MSYS, switch paths to Windows format before running java
case "`uname`" in
  (CYGWIN*)
    APP_HOME=`cygpath --path --mixed "$APP_HOME"`
    CP="$APP_HOME/gradle/wrapper/gradle-wrapper.jar"
    CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`
    JAVACMD=`cygpath --unix "$JAVACMD"`
    ;;
esac

# Collect all arguments for the java command
#     * $DEFAULT_JVM_OPTS - controlled by the user
#     * $JAVA_OPTS - components dependent on the OS
#     * $GRADLE_OPTS - the user-defined Gradle options
#     * $EXTRA_GRADLE_OPTS - extra options that the build adds
eval set -- $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS "\"-Dorg.gradle.appname=$APP_BASE_NAME\"" -classpath "\"$CLASSPATH\"" org.gradle.wrapper.GradleWrapperMain "$@"

exec "$JAVACMD" "$@"
